{"componentChunkName":"component---src-templates-blog-post-js","path":"/export-relationship-data-in-laravel-admin/","result":{"data":{"site":{"siteMetadata":{"title":"tateren.github.io"}},"markdownRemark":{"id":"40484e9c-ee8e-5787-8d35-99ef80879d82","excerpt":"経緯 Laravel admin | Data export laravel-admin で Laravel-Excel を使用してデータエクスポートをする際に以下のような ExcelExporter クラスを作る。 ここで Post がリレーション author を持っている時、grid…","html":"<h2>経緯</h2>\n<p><a href=\"https://laravel-admin.org/docs/en/model-grid-export#Laravel-Excel%20v3.*\">Laravel admin | Data export</a></p>\n<p>laravel-admin で Laravel-Excel を使用してデータエクスポートをする際に以下のような ExcelExporter クラスを作る。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">Namespace</span> App\\<span class=\"token package\">Admin<span class=\"token punctuation\">\\</span>Extensions</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">Use</span> Encore\\<span class=\"token package\">Admin<span class=\"token punctuation\">\\</span>Grid<span class=\"token punctuation\">\\</span>Exporters<span class=\"token punctuation\">\\</span>ExcelExporter</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PostsExporter</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ExcelExporter</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$fileName</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'Article list.xlsx'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$columns</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token single-quoted-string string\">'id'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'ID'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token single-quoted-string string\">'title'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'title'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token single-quoted-string string\">'content'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'content'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>ここで Post がリレーション author を持っている時、grid の要領で</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$columns</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token single-quoted-string string\">'id'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'ID'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token single-quoted-string string\">'title'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'title'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token single-quoted-string string\">'content'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'content'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token single-quoted-string string\">'author.name'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'author name'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>と書けば出力できるんじゃないかと期待して試してみたが特にそんな事は無かった。</p>\n<h2>正しい実装方法</h2>\n<p>WithMapping インターフェースを実装して map() をこんな感じにすれば期待する出力が得られた。</p>\n<p>ヘッダーは名前だけ指定すれば良いので $columns から $headings に変更している。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Admin<span class=\"token punctuation\">\\</span>Extensions</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Models<span class=\"token punctuation\">\\</span>Post</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Encore<span class=\"token punctuation\">\\</span>Admin<span class=\"token punctuation\">\\</span>Grid<span class=\"token punctuation\">\\</span>Exporters<span class=\"token punctuation\">\\</span>ExcelExporter</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Maatwebsite<span class=\"token punctuation\">\\</span>Excel<span class=\"token punctuation\">\\</span>Concerns<span class=\"token punctuation\">\\</span>WithMapping</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PostsExporter</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ExcelExporter</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WithMapping</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$fileName</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'Article list.xlsx'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$headings</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token single-quoted-string string\">'ID'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token single-quoted-string string\">'title'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token single-quoted-string string\">'content'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token single-quoted-string string\">'author name'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$row</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">array</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/** @var Post $row */</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token single-quoted-string string\">'ID'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token variable\">$row</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">id</span><span class=\"token punctuation\">,</span>\n            <span class=\"token single-quoted-string string\">'title'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token variable\">$row</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">title</span><span class=\"token punctuation\">,</span>\n            <span class=\"token single-quoted-string string\">'content'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token variable\">$row</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">content</span><span class=\"token punctuation\">,</span>\n            <span class=\"token single-quoted-string string\">'author name'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token variable\">$row</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">author</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">name</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>","frontmatter":{"title":"laravel-admin のエクスポートにリレーションデータを含める方法","date":"September 30, 2021","description":"laravel-admin のエクスポートにリレーションデータを含める方法"}},"previous":{"fields":{"slug":"/number-format/"},"frontmatter":{"title":"laravel-admin の grid で number_format"}},"next":{"fields":{"slug":"/set-page-break-preview-in-phpspreadsheet/"},"frontmatter":{"title":"Phpspreadsheet で表示モードを改ページプレビューに設定する"}}},"pageContext":{"id":"40484e9c-ee8e-5787-8d35-99ef80879d82","previousPostId":"1cd8860f-8ac4-5d48-9af0-15524c4bb0dd","nextPostId":"c8ccb4dd-715b-54b5-9527-528f10707740"}},"staticQueryHashes":["2841359383","916993862"]}