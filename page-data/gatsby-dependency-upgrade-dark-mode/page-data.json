{"componentChunkName":"component---src-templates-blog-post-js","path":"/gatsby-dependency-upgrade-dark-mode/","result":{"data":{"site":{"siteMetadata":{"title":"tateren.github.io"}},"markdownRemark":{"id":"7a375d94-c329-5b41-a5eb-40cd6bc82801","excerpt":"このブログ、長年放置していたのですが、さすがに色々なものが古くなりすぎていました。Gatsbyのバージョンは古いし、セキュリティ的にも心配...。そこで今回は、最近使っているCLIのAIアシスタントに指示を出しながら、どこまでモダンな環境に改修できるか挑戦してみました。 本記事では、「どんな指示（プロンプト）で、AI…","html":"<p>このブログ、長年放置していたのですが、さすがに色々なものが古くなりすぎていました。Gatsbyのバージョンは古いし、セキュリティ的にも心配...。そこで今回は、最近使っているCLIのAIアシスタントに指示を出しながら、どこまでモダンな環境に改修できるか挑戦してみました。</p>\n<p>本記事では、「どんな指示（プロンプト）で、AIがどう動いたか」という、AIとのペアプログラミングのような開発作業の全記録を残しておこうと思います。</p>\n<h3>第一章: 依存関係の海へダイブ</h3>\n<p>まずは、古くなった依存関係の整理から。最初の指示はシンプルに、こう切り出しました。</p>\n<blockquote>\n<p><strong>指示:</strong> このプロジェクトで使用されている依存関係のバージョンが古いので、新しいバージョンへアップグレードする計画を立ててください。</p>\n</blockquote>\n<p>AIはすぐに<code class=\"language-text\">npm outdated</code>を実行して現状を把握し、安全に更新するための段階的な計画を提案してくれました。計画を承認し、いざ実行！</p>\n<blockquote>\n<p><strong>AIの応答:</strong> 承知いたしました。計画通り、Gatsby本体と関連プラグインの更新から開始します。</p>\n</blockquote>\n<p>計画通りGatsby関連のパッケージが更新された直後、最初の壁にぶつかりました。</p>\n<h3>第二章: 謎のビルドエラーとAIの推察</h3>\n<p>早速実行したビルドは、あえなく失敗。画面にはこんなエラーが。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ERROR #11321 \"length\" is outside of buffer bounds</code></pre></div>\n<p>AIはキャッシュクリアなどを試みましたが、状況は変わらず。しかし、エラーメッセージを元に追加調査を行ったAIは、「Node.jsのバージョンが原因かもしれない」という可能性を指摘してきました。当時私が使っていた<code class=\"language-text\">v24</code>と、Gatsbyの内部ライブラリの相性問題を突き止めたのです。</p>\n<p>言われた通り、私の環境でNode.jsのバージョンを安定版の<code class=\"language-text\">v22</code>に切り替えて作業を続行させると...無事にビルドが成功！AIとの共同作業で、見事に問題を切り分けることができました。</p>\n<h3>第三章: 「なんかフォント違くない？」</h3>\n<p>ビルドは通ったものの、サイトの表示を確認すると、どうもフォントの雰囲気が以前と違います。すかさず、次の指示を出しました。</p>\n<blockquote>\n<p><strong>指示:</strong> フォントが変わってしまっているようですが元のフォントを維持する事はできますか？</p>\n</blockquote>\n<p>この曖昧な指示から<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>、AIは「<code class=\"language-text\">@fontsource</code>パッケージのメジャーバージョンアップによる破壊的変更が原因ではないか」と推測。調査の結果、v5からは可変フォントの読み込み方が<code class=\"language-text\">@fontsource-variable/</code>という別パッケージに変わっていたことを突き止めました。</p>\n<p>しかし、パッケージを入れ替えても問題は解決せず。AIはさらに調査を進め、最終的にCSS側で指定しているフォント名<code class=\"language-text\">'MontserratVariable'</code>（スペースなし）と、新しいパッケージが提供するフォント名<code class=\"language-text\">'Montserrat Variable'</code>（スペースあり）の僅かな違いが原因であることを特定。見事に元のフォント表示を復元してくれました。この探偵作業は、自力でやっていたら相当時間がかかったはずです。</p>\n<h3>第四章: セキュリティの穴を塞ぐ</h3>\n<p>技術的な問題を片付けるため、次はセキュリティ脆弱性の対応を依頼しました。</p>\n<blockquote>\n<p><strong>指示:</strong> npm auditで出るその他の脆弱性は対応する必要がありますか？対応は可能ですか？</p>\n</blockquote>\n<p>AIはまず、脆弱性への対応は重要であると述べた上で、安全な修正計画を提案。<code class=\"language-text\">npm audit fix</code>では破壊的変更が起きてしまう問題に対し、<code class=\"language-text\">package.json</code>の<code class=\"language-text\">overrides</code>機能を使う方法を提示してくれました。</p>\n<div class=\"gatsby-highlight\" data-language=\"json:title=package.json\"><pre class=\"language-json:title=package.json\"><code class=\"language-json:title=package.json\">  &quot;overrides&quot;: {\n    &quot;cookie&quot;: &quot;&gt;=0.7.0&quot;,\n    &quot;tmp&quot;: &quot;&gt;=0.2.4&quot;\n  }</code></pre></div>\n<p>この指示で、修正可能な脆弱性はすべて解決。一部、ライブラリ側でまだ修正がリリースされていない脆弱性が残りましたが、その理由まで丁寧に説明してくれました。</p>\n<h3>第五章: いよいよデザイン改修へ</h3>\n<p>技術的な負債の返済が終わったところで、お待ちかねのデザイン改修です。</p>\n<blockquote>\n<p><strong>指示:</strong> サイトのデザインをダークモードに変更したいです。</p>\n</blockquote>\n<p>AIはすぐにCSS変数を書き換え、ダークモードの初期実装を完了。しかし、出来上がったデザインは少しコントラストが強すぎると感じました。そこで、すかさず追加の指示を出します。</p>\n<blockquote>\n<p><strong>追加指示:</strong> Nord（ <a href=\"https://www.nordtheme.com/\">https://www.nordtheme.com/</a> ）のような雰囲気にする事はできますか？</p>\n</blockquote>\n<p>この指示を受け、AIはNordの公式サイトからカラーパレットを抽出。それを元に再度CSSを調整し、目に優しい、落ち着いた雰囲気のデザインに見事に修正してくれました。</p>\n<p>仕上げに、コードブロックのテーマも全体の雰囲気に合わせるため、利用可能なテーマ一覧をAIに表示させ、最終的に<code class=\"language-text\">prism-one-dark</code>を選択。これでデザイン作業も完了です。</p>\n<h3>終わりに: AIとのペアプログラミング体験</h3>\n<p>今回の改修作業は、まるでAIアシスタントとペアプログラミングをしているような体験でした。私が「何をしたいか」「どう感じたか」という方針やフィードバックを与え、AIがそれを元に具体的な調査、分析、実装を行う。このサイクルを高速に回すことで、自分一人でやるよりも圧倒的なスピードで開発を進めることができました。</p>\n<p>この記事自体も、AIに「今回の修正対応の流れをブログ記事としてまとめて」と指示し、出てきた草稿に「AIと共同作業した流れが分かるように書き直して」と追加指示して作成したものです。<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup></p>\n<p>具体的な指示さえ出せれば、AIは強力な相棒になってくれる。そんなことを実感したプロジェクトでした。</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">今私の指示の出し方 dis った？<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-2\">注釈は人間の手による温かみのあるツッコミです<a href=\"#fnref-2\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","frontmatter":{"title":"AIアシスタントと挑む！古いGatsbyブログの完全リファクタリング日誌","date":"2025-12-15","description":"CLIのAIアシスタントに指示を出しながら、古いGatsbyブログの依存関係更新からダークモード対応まで、一気に駆け抜けた改修作業の全記録です。"}},"previous":{"fields":{"slug":"/coc-phpls-enum/"},"frontmatter":{"title":"coc-phpls を入れている環境で Enum を定義する"}},"next":null},"pageContext":{"id":"7a375d94-c329-5b41-a5eb-40cd6bc82801","previousPostId":"9e0219ae-3ebe-521d-b941-1b828c5c80e2","nextPostId":null}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}