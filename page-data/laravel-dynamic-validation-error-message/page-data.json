{"componentChunkName":"component---src-templates-blog-post-js","path":"/laravel-dynamic-validation-error-message/","result":{"data":{"site":{"siteMetadata":{"title":"tateren.github.io"}},"markdownRemark":{"id":"77f5595a-4f03-538b-a65a-a201dc41f214","excerpt":"attribute とか parameters ではなくバリデーションの過程で得られる情報をエラーメッセージに埋め込みたかった。 実装例 カンマ区切りの数値形式の文字列である事を検証するカスタムバリデーションルールで数値形式の文字列じゃなかった値をエラーメッセージに埋め込む。  を実装して Rule…","html":"<p>attribute とか parameters ではなくバリデーションの過程で得られる情報をエラーメッセージに埋め込みたかった。</p>\n<h2>実装例</h2>\n<p>カンマ区切りの数値形式の文字列である事を検証するカスタムバリデーションルールで数値形式の文字列じゃなかった値をエラーメッセージに埋め込む。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Rules</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Validation<span class=\"token punctuation\">\\</span>Rule</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Contracts<span class=\"token punctuation\">\\</span>Validation<span class=\"token punctuation\">\\</span>ValidatorAwareRule</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Validation<span class=\"token punctuation\">\\</span>Validator</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">CommaSeparatedNumeric</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Rule</span><span class=\"token punctuation\">,</span> ValidatorAwareRule\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token class-name type-declaration\">Validator</span> <span class=\"token variable\">$validator</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * @param Validator $validator\n     * @return $this\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">setValidator</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$validator</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">self</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">validator</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$validator</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * @param string $attribute\n     * @param mixed $values\n     * @return bool\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">passes</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$attribute</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$values</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token function\">explode</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">','</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$values</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">is_numeric</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">validator</span><span class=\"token operator\">-></span><span class=\"token function\">addReplacer</span><span class=\"token punctuation\">(</span>\n                    <span class=\"token keyword static-context\">self</span><span class=\"token operator\">::</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token keyword\">fn</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$message</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">str_replace</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">':value'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$value</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$message</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">message</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword return-type\">string</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string single-quoted-string\">':attribute must be comma separated numeric. (:value is not numeric)'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">ValidatorAwareRule</code> を実装して Rule クラス内から <code class=\"language-text\">Validator</code> に触れるようにする。</li>\n<li><code class=\"language-text\">Validator::addReplacer()</code> で動的にエラーメッセージの Replacer を追加する。</li>\n</ul>\n<h2>実行例</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">>>> use App\\Rules\\CommaSeparatedNumeric\n>>> Validator::make(['input' => '1,2,3'], ['input' => new CommaSeparatedNumeric()])->validate()\n=> [\n     \"input\" => \"1,2,3\",\n   ]\n\n>>> Validator::make(['input' => '1,2,3,a,b,c'], ['input' => new CommaSeparatedNumeric()])->validate()\nIlluminate\\Validation\\ValidationException with message 'input must be comma separated numeric. (a is not numeric)'</code></pre></div>\n<p>この例だったら最初から配列に変換しておけ感はある。</p>","frontmatter":{"title":"Laravel のバリデーションエラーメッセージに動的に値を埋め込む","date":"2022-05-24","description":"Laravel のバリデーションエラーメッセージに動的に値を埋め込む方法"}},"previous":{"fields":{"slug":"/set-page-break-preview-in-phpspreadsheet/"},"frontmatter":{"title":"Phpspreadsheet で表示モードを改ページプレビューに設定する"}},"next":{"fields":{"slug":"/coc-phpls-enum/"},"frontmatter":{"title":"coc-phpls を入れている環境で Enum を定義する"}}},"pageContext":{"id":"77f5595a-4f03-538b-a65a-a201dc41f214","previousPostId":"c8ccb4dd-715b-54b5-9527-528f10707740","nextPostId":"9e0219ae-3ebe-521d-b941-1b828c5c80e2"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}